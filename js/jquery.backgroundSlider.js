// Generated by CoffeeScript 1.6.2
(function() {
  var $, $w, BackgroundSlider, WindowResize, debounce, windowResize,
    __slice = [].slice,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  $ = window.jQuery;

  $w = $(window);

  debounce = function(func, wait, immediate) {
    var timeout;

    timeout = null;
    return function() {
      var args, callNow, context, later;

      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      context = this;
      later = function() {
        timeout = null;
        if (!immediate) {
          return func.apply(context, args);
        }
      };
      callNow = immediate && !timeout;
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
      if (callNow) {
        return func.apply(context, args);
      }
    };
  };

  WindowResize = (function() {
    function WindowResize() {
      this.removeListener = __bind(this.removeListener, this);
      this.addListener = __bind(this.addListener, this);
      this._handle = __bind(this._handle, this);      this.handlers = [];
      this.windowWidth = $w.width();
      this.windowHeight = $w.height();
      this.handle = debounce(this._handle, 150);
      $w.resize(this.handle);
    }

    WindowResize.prototype._handle = function() {
      var handler, _i, _len, _ref, _results;

      this.windowWidth = $w.width();
      this.windowHeight = $w.height();
      _ref = this.handlers;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        handler = _ref[_i];
        _results.push(handler.call(handler, this.windowWidth, this.windowHeight));
      }
      return _results;
    };

    WindowResize.prototype.addListener = function(hndlr) {
      var handler, _i, _len, _ref;

      _ref = this.handlers;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        handler = _ref[_i];
        if (hndlr === handler) {
          return false;
        }
      }
      this.handlers.push(hndlr);
      hndlr.call(hndlr, this.windowWidth, this.windowHeight);
      return true;
    };

    WindowResize.prototype.removeListener = function(hndlr) {
      var handler, removed, _handlers, _i, _len, _ref;

      _handlers = [];
      removed = false;
      _ref = this.handlers;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        handler = _ref[_i];
        if (handler !== hndlr) {
          _handlers.push(handler);
        } else {
          removed = true;
        }
      }
      this.handlers = _handlers;
      return removed;
    };

    return WindowResize;

  })();

  windowResize = new WindowResize;

  BackgroundSlider = (function() {
    function BackgroundSlider(el, opts) {
      this.el = el;
      this.opts = opts;
      this.handleResize = __bind(this.handleResize, this);
      this.getOriginalImgSizes = __bind(this.getOriginalImgSizes, this);
      this.nextSlide = __bind(this.nextSlide, this);
      this.anim_sidebyside = __bind(this.anim_sidebyside, this);
      this.anim_fade = __bind(this.anim_fade, this);
      this.anim_reveal = __bind(this.anim_reveal, this);
      this.getSlide = __bind(this.getSlide, this);
      this.$el = $(this.el);
      this.lis = $('li', this.$el);
      this.imgEls = $('img', this.lis);
      this.imgs = [];
      this.ready = false;
      this.getOriginalImgSizes();
      this.slideNum = this.opts.current;
      this.animType = this.opts.animType.toLowerCase();
      this.origpos = this.$el.css('position');
      this.origpostop = this.$el.css('top');
      this.origposleft = this.$el.css('left');
      this.$el.css({
        position: 'fixed',
        top: '-30000px',
        left: '-30000px'
      });
    }

    BackgroundSlider.prototype.getSlide = function() {
      if (this.slideNum > this.lis.length) {
        this.slideNum = 0;
      } else {
        this.slideNum += 1;
      }
      return this.lis[this.slideNum];
    };

    BackgroundSlider.prototype.anim_reveal = function(newSlide, oldSlide) {
      var _this = this;

      newSlide.css({
        zIndex: 5,
        display: 'block',
        left: '0px'
      });
      return (function(newSlide, oldSlide) {
        console.log('newSlide', newSlide, 'oldSlide', oldSlide);
        return oldSlide.animate({
          left: "-" + ($w.width()) + "px"
        }, {
          easing: _this.opts.easing,
          duration: _this.opts.animationTime,
          always: function() {
            console.log('oldSlide', oldSlide);
            oldSlide.css({
              display: 'none',
              zIndex: 1
            });
            return newSlide.css({
              zIndex: 10
            });
          }
        });
      })(newSlide, oldSlide);
    };

    BackgroundSlider.prototype.anim_fade = function(newSlide, oldSlide) {
      var _this = this;

      newSlide.css({
        zIndex: 5,
        display: 'block',
        opacity: 1
      });
      oldSlide.css({
        opacity: 1,
        display: 'block',
        zIndex: 10
      });
      return (function(newSlide, oldSlide) {
        return oldSlide.animate({
          opacity: 0
        }, {
          easing: _this.opts.easing,
          duration: _this.opts.animationTime,
          always: function() {
            oldSlide.css({
              display: 'none',
              zIndex: 1
            });
            return newSlide.css({
              zIndex: 10
            });
          }
        });
      })(newSlide, oldSlide);
    };

    BackgroundSlider.prototype.anim_sidebyside = function(newSlide, oldSlide) {
      var _this = this;

      newSlide.css({
        zIndex: 5,
        display: 'block',
        left: "" + ($w.width()) + "px",
        top: '0px'
      });
      oldSlide.css({
        display: 'block',
        zIndex: 10,
        left: "0px",
        top: '0px'
      });
      return (function(newSlide, oldSlide) {
        oldSlide.animate({
          left: "-" + ($w.width()) + "px"
        }, {
          easing: _this.opts.easing,
          duration: _this.opts.animationTime,
          always: function() {
            return oldSlide.css({
              display: 'none',
              zIndex: 1
            });
          }
        });
        return newSlide.animate({
          left: '0px'
        }, {
          easing: _this.opts.easing,
          duration: _this.opts.animationTime,
          always: function() {
            return newSlide.css({
              zIndex: 10
            });
          }
        });
      })(newSlide, oldSlide);
    };

    BackgroundSlider.prototype.nextSlide = function() {
      var newSlide, oldSlide;

      oldSlide = this.currentSlide;
      newSlide = $(this.getSlide());
      this.updateImgs($w.width(), $w.height());
      this["anim_" + this.animType](newSlide, oldSlide);
      return this.currentSlide = newSlide;
    };

    BackgroundSlider.prototype.setBaseStyles = function() {
      this.$el.css({
        listStyle: 'none',
        margin: '0',
        padding: '0',
        overflow: 'hidden',
        width: '100%',
        height: '100%',
        position: 'fixed',
        top: '0',
        left: '0'
      });
      this.lis.css({
        listStyle: 'none',
        margin: '0',
        padding: '0',
        position: 'absolute',
        top: '0',
        left: '0',
        width: '100%',
        height: '100%',
        display: 'none',
        overflow: 'hidden',
        zIndex: 1
      });
      return this.imgEls.css({
        position: 'absolute',
        top: '0',
        left: '0'
      });
    };

    BackgroundSlider.prototype.getOriginalImgSizes = function() {
      var $firstSlide, $img, firstSlide, ih, img, imgs, iw, ready, wh, ww, _i, _len, _ref;

      imgs = [];
      ww = $w.width();
      wh = $w.height();
      ready = true;
      _ref = this.imgEls;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        img = _ref[_i];
        $img = $(img);
        iw = $img.width();
        ih = $img.height();
        if (iw === 0 || ih === 0) {
          ready = false;
        }
        imgs.push({
          origWidth: iw,
          origHeight: ih,
          $img: $img
        });
      }
      if (!ready) {
        return setTimeout(this.getOriginalImgSizes, 100);
      }
      this.imgs = imgs;
      this.ready = true;
      windowResize.addListener(this.handleResize);
      this.updateImgs($w.width(), $w.height());
      this.$el.css({
        position: this.origpos,
        top: this.origpostop,
        left: this.origposleft
      });
      if (this.opts.injectStyles) {
        this.setBaseStyles();
      }
      firstSlide = this.lis[this.slideNum];
      $firstSlide = $(firstSlide);
      $firstSlide.css({
        zIndex: 10,
        display: 'block'
      });
      this.currentSlide = $firstSlide;
      return setInterval(this.nextSlide, this.opts.delay);
    };

    BackgroundSlider.prototype.handleResize = function(w, h) {
      if (!this.ready) {
        return;
      }
      return this.updateImgs(w, h);
    };

    BackgroundSlider.prototype.updateImgs = function(w, h) {
      var img, _i, _len, _ref, _results;

      _ref = this.imgs;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        img = _ref[_i];
        _results.push(this.updateImg(w, h, img));
      }
      return _results;
    };

    BackgroundSlider.prototype.updateImg = function(w, h, img) {
      var $img, height, highestScale, ih, iw, left, top, width;

      $img = img.$img;
      iw = img.origWidth;
      ih = img.origHeight;
      if (iw === 0 || ih === 0) {
        console.log('iw', iw, 'ih', ih);
        $img.width(null);
        $img.height(null);
        $img.css({
          height: 'auto',
          width: 'auto'
        });
        iw = $img.width();
        ih = $img.height();
      }
      highestScale = Math.max(w / iw, h / ih);
      width = Math.round(iw * highestScale);
      height = Math.round(ih * highestScale);
      left = Math.round((w / 2) - (width / 2));
      top = Math.round((h / 2) - (height / 2));
      $img.css({
        width: "" + width + "px",
        height: "" + height + "px",
        top: "" + top + "px",
        left: "" + left + "px"
      });
      return void 0;
    };

    return BackgroundSlider;

  })();

  $.fn.backgroundSlider = function($o) {
    var _o;

    _o = $.extend({
      easing: 'linear',
      delay: 6000,
      animationTime: 600,
      current: 0,
      sliding: false,
      animType: 'reveal',
      injectStyles: false
    }, $o);
    return this.each(function(i, el) {
      var slider;

      slider = new BackgroundSlider(el, _o);
      return $(el).data('slider', slider);
    });
  };

}).call(this);

/*
//@ sourceMappingURL=jquery.backgroundSlider.map
*/
